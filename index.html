<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PTA係一覧</title>
<style>

  /* 入力用テーブル */
  .input-table-wrapper {
    max-width: 300px;   /* 入力表の最大幅 */
    overflow-x: auto;
    margin: 0;          /* 左寄せ */
  }

  /* 表示用免除権表 */
  .exempt-table-wrapper {
    max-width: 600px;   /* 免除権表の最大幅 */
    overflow-x: auto;
    margin: 0;          /* 左寄せ */
  }

  /* テーブル全体 */
  table {
    border-collapse: collapse;
    width: 100%;
    min-width: 200px;
  }

  /* セル全体の左寄せ */
  table th, table td {
    text-align: left;   /* 左寄せ */
    border: 1px solid #999;
    padding: 4px 6px;
    font-size: 14px;
  }

  /* チェックボックス列は中央寄せ */
  #ptaTable td input {
    display: block;
    margin: 0 auto;
  }

  td.disabled {
    background-color: #eee;
    color: #666;
  }

  th {
    background-color: #f2f2f2;
  }

  /* 免除権表の兄弟全員免除セル */
  .exempt-table tr[data-multi="true"] td {
    background-color: #fff8b3; /* 薄い黄色 */
  }
</style>
</head>
<body>

<h2>PTA免除権シミュレータ</h2>

<!-- 入力用表 -->
<div class="input-table-wrapper">
  <table id="ptaTable">
    <thead>
      <tr>
        <th>係</th>
        <th>1人目</th>
        <th>2人目</th>
        <th>3人目</th>
      </tr>
    </thead>
    <tbody>
      <tr data-role="代表委員">
        <td>代表委員</td>
        <td><input type="checkbox" data-child="1"></td>
        <td><input type="checkbox" data-child="2"></td>
        <td><input type="checkbox" data-child="3"></td>
      </tr>
      <tr data-role="地区リーダー">
        <td>地区リーダー</td>
        <td><input type="checkbox" data-child="1"></td>
        <td><input type="checkbox" data-child="2"></td>
        <td><input type="checkbox" data-child="3"></td>
      </tr>
      <tr data-role="正地区委員">
        <td>正地区委員</td>
        <td><input type="checkbox" data-child="1"></td>
        <td><input type="checkbox" data-child="2"></td>
        <td><input type="checkbox" data-child="3"></td>
      </tr>
      <tr data-role="副地区委員">
        <td>副地区委員</td>
        <td><input type="checkbox" data-child="1"></td>
        <td><input type="checkbox" data-child="2"></td>
        <td><input type="checkbox" data-child="3"></td>
      </tr>
      <tr data-role="クラス委員">
        <td>クラス委員</td>
        <td><input type="checkbox" data-child="1"></td>
        <td><input type="checkbox" data-child="2"></td>
        <td><input type="checkbox" data-child="3"></td>
      </tr>
      <tr data-role="交安協(3年)">
        <td>交安協(3年)</td>
        <td><input type="checkbox" data-child="1"></td>
        <td><input type="checkbox" data-child="2"></td>
        <td><input type="checkbox" data-child="3"></td>
      </tr>
      <tr data-role="卒対(6年)">
        <td>卒対(6年)</td>
        <td><input type="checkbox" data-child="1"></td>
        <td><input type="checkbox" data-child="2"></td>
        <td><input type="checkbox" data-child="3"></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- 表示用免除権表 -->
<h2>免除権一覧（表示専用）</h2>

<div class="exempt-table-wrapper">
  <table class="exempt-table">
    <thead>
      <tr>
        <th>係</th>
        <th>免除される係</th>
      </tr>
    </thead>
    <tbody>
      <tr data-multi="true">
        <td>代表委員</td>
        <td>代表委員、地区リーダー、交安協、卒対</td>
      </tr>
      <tr data-multi="true">
        <td>地区リーダー</td>
        <td>代表委員、地区リーダー、交安協、卒対、正地区委員</td>
      </tr>
      <tr>
        <td>正地区委員</td>
        <td>地区リーダー、正地区委員</td>
      </tr>
      <tr>
        <td>副地区委員</td>
        <td>正地区委員、副地区委員</td>
      </tr>
      <tr>
        <td>クラス委員</td>
        <td>代表委員、クラス委員、交安協、卒対</td>
      </tr>
      <tr>
        <td>交安協(3年)</td>
        <td>代表委員、クラス委員、交安協、卒対</td>
      </tr>
      <tr>
        <td>卒対(6年)</td>
        <td>なし</td>
      </tr>
    </tbody>
  </table>
</div>

<p style="margin-top:4px; font-size:14px; color:#333;">
  <span style="background-color:#fff8b3; padding:2px 4px;">黄色</span> は兄弟全員免除を示します。
</p>

<script>
const exemptionRules = {
  "代表委員": ["代表委員", "地区リーダー", "交安協(3年)", "卒対(6年)"],
  "地区リーダー": ["代表委員", "地区リーダー", "交安協(3年)", "卒対(6年)", "正地区委員"],
  "正地区委員": ["地区リーダー", "正地区委員"],
  "副地区委員": ["正地区委員", "副地区委員"],
  "クラス委員": ["代表委員", "クラス委員", "交安協(3年)", "卒対(6年)"],
  "交安協(3年)": ["代表委員", "クラス委員", "交安協(3年)", "卒対(6年)"],
  "卒対(6年)": []
};

const multiChildExempt = ["代表委員","地区リーダー"]; // 兄弟全員免除

const rows = document.querySelectorAll("#ptaTable tbody tr");

rows.forEach(row => {
  row.querySelectorAll("input[type='checkbox']").forEach(cb => {
    cb.addEventListener("change", () => {
      // グレー表示リセット
      rows.forEach(r => r.querySelectorAll("td").forEach(td => td.classList.remove("disabled")));

      // チェックされた全ボックス
      const checkedBoxes = Array.from(document.querySelectorAll("input[type='checkbox']:checked"));

      checkedBoxes.forEach(box => {
        const role = box.closest("tr").getAttribute("data-role");
        const child = box.getAttribute("data-child");

        const exemptList = exemptionRules[role] || [];

        exemptList.forEach(ex => {
          const targetRow = document.querySelector(`[data-role='${ex}']`);
          if (!targetRow) return;

          if (multiChildExempt.includes(role)) {
            // 兄弟全員列をグレーアウト
            targetRow.querySelectorAll("td input").forEach(input => input.parentNode.classList.add("disabled"));
          } else {
            // その子のみグレーアウト
            const targetCell = targetRow.querySelector(`input[data-child='${child}']`).parentNode;
            targetCell.classList.add("disabled");
          }
        });
      });
    });
  });
});
</script>

</body>
</html>